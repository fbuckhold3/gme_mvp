/* =============================================================================
   Enhanced Milestone App Styles with Working Sticky Sidebar
   ============================================================================= */

/* Color Palette */
:root {
  --primary-blue: #2C3E50;
  --secondary-blue: #3498DB;
  --light-gray: #f8f9fa;
  --border-gray: #dee2e6;
  --text-muted: #6c757d;
  --success-green: #28a745;
  --warning-orange: #fd7e14;
  --danger-red: #dc3545;
}

/* Global Overrides */
.btn-primary { 
  background-color: var(--primary-blue); 
  border-color: var(--primary-blue); 
}

.nav-tabs > li.active > a { 
  background-color: var(--primary-blue); 
  color: white; 
}

/* Layout Improvements */
.main-container {
  max-width: 1400px;
  margin: 0 auto;
}

.sidebar-card {
  background: var(--light-gray);
  border: 1px solid var(--border-gray);
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.content-card {
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  margin-bottom: 1.5rem;
}

/* FIXED STICKY SIDEBAR - This is the key fix */
.js-sticky-sidebar {
  position: sticky !important;
  position: -webkit-sticky !important;
  top: 20px !important;
  align-self: flex-start;
  z-index: 100;
  max-height: calc(100vh - 40px);
  overflow-y: auto;
  /* Ensure it doesn't get overridden by Bootstrap */
  display: block !important;
}

/* Force the parent containers to allow sticky positioning */
.row {
  display: flex !important;
  flex-wrap: wrap;
}

/* Critical: Ensure Bootstrap columns work with flexbox and sticky */
.row > [class*="col-"] {
  display: flex;
  flex-direction: column;
  min-height: 0; /* Important for sticky to work properly */
}

/* Specific fix for Bootstrap's grid system interference */
.col-3 .js-sticky-sidebar,
.col-4 .js-sticky-sidebar {
  position: sticky !important;
  position: -webkit-sticky !important;
}

/* Fix for Shiny's tab content containers */
.tab-content {
  display: block !important;
}

.tab-pane {
  display: block !important;
}

.tab-pane.active {
  display: block !important;
}

/* Ensure the main content column grows to fill space */
.col-9 {
  flex: 1;
  min-height: 100vh; /* This ensures there's enough content to scroll */
}

/* Scrollbar styling for the sticky sidebar */
.js-sticky-sidebar::-webkit-scrollbar {
  width: 6px;
}

.js-sticky-sidebar::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 3px;
}

.js-sticky-sidebar::-webkit-scrollbar-thumb {
  background: #c1c1c1;
  border-radius: 3px;
}

.js-sticky-sidebar::-webkit-scrollbar-thumb:hover {
  background: #a8a8a8;
}

/* Alternative approach using JavaScript (add this to your UI head section) */
/* You can also add this JavaScript to make it more robust: */

/*
$(document).ready(function() {
  // Enhanced sticky sidebar with JavaScript fallback
  function initStickyElements() {
    $('.js-sticky-sidebar').each(function() {
      var $sidebar = $(this);
      var $parent = $sidebar.closest('.row');
      var sidebarTop = $sidebar.offset().top - 20;
      
      $(window).scroll(function() {
        var scrollTop = $(window).scrollTop();
        var parentBottom = $parent.offset().top + $parent.outerHeight();
        var sidebarHeight = $sidebar.outerHeight();
        var windowHeight = $(window).height();
        
        if (scrollTop > sidebarTop) {
          if (scrollTop + sidebarHeight + 40 < parentBottom) {
            $sidebar.css({
              'position': 'fixed',
              'top': '20px',
              'width': $sidebar.parent().width() + 'px'
            });
          } else {
            $sidebar.css({
              'position': 'absolute',
              'top': (parentBottom - sidebarHeight - 40) + 'px',
              'width': $sidebar.parent().width() + 'px'
            });
          }
        } else {
          $sidebar.css({
            'position': 'relative',
            'top': 'auto',
            'width': 'auto'
          });
        }
      });
    });
  }
  
  // Initialize after Shiny content loads
  setTimeout(initStickyElements, 1000);
  
  // Reinitialize when tab changes
  $('a[data-toggle="tab"]').on('shown.bs.tab', function() {
    setTimeout(initStickyElements, 100);
  });
});
*/

/* Cards */
.card {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  border: none;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.card-header {
  background: linear-gradient(135deg, var(--light-gray) 0%, #e9ecef 100%);
  border-bottom: 1px solid var(--border-gray);
  font-weight: 600;
}

/* Typography */
h4, h5, h6 {
  color: var(--primary-blue);
  margin-bottom: 1rem;
}

.section-title {
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--primary-blue);
  margin-bottom: 0.75rem;
  padding-bottom: 0.5rem;
  border-bottom: 2px solid var(--border-gray);
}

/* Controls */
.form-group {
  margin-bottom: 1rem;
}

.form-control, .selectize-input {
  border-radius: 6px;
  border: 1px solid var(--border-gray);
}

.form-control:focus, .selectize-input.focus {
  border-color: var(--secondary-blue);
  box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
}

/* Checkboxes and Radio Buttons */
.checkbox-group {
  max-height: 200px;
  overflow-y: auto;
  padding: 0.5rem;
  background: white;
  border: 1px solid var(--border-gray);
  border-radius: 6px;
}

/* Buttons */
.btn {
  border-radius: 6px;
  font-weight: 500;
  transition: all 0.2s ease;
}

.btn-group-sm .btn {
  padding: 0.25rem 0.5rem;
  font-size: 0.875rem;
}

/* Demo Button */
.demo-button {
  background: linear-gradient(135deg, var(--success-green) 0%, #20c997 100%);
  border: none;
  color: white;
  padding: 0.75rem 1.5rem;
  border-radius: 8px;
  font-weight: 600;
  transition: all 0.3s ease;
}

.demo-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
}

/* Alerts */
.alert {
  border-radius: 8px;
  border: none;
  margin-bottom: 1rem;
}

.alert-info {
  background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
  color: #0c5460;
}

.alert-warning {
  background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
  color: #856404;
}

/* Timeline */
.milestone-timeline {
  border-left: 3px solid var(--border-gray);
  padding-left: 20px;
  margin-left: 10px;
}

.timeline-item {
  position: relative;
  padding-left: 0px;
  margin-bottom: 0.75rem;
}

.timeline-item::before {
  content: '';
  position: absolute;
  left: -26px;
  top: 8px;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background-color: var(--text-muted);
}

/* Tables */
.dataTables_wrapper {
  margin-top: 1rem;
}

.table {
  margin-bottom: 0;
}

/* Milestone Reference Table */
#milestone_reference_table {
  border-collapse: separate;
  border-spacing: 1px;
  table-layout: fixed;
  width: 100%;
}

#milestone_reference_table td {
  border: none;
  padding: 8px;
  vertical-align: middle;
}

#milestone_reference_table th:first-child,
#milestone_reference_table td:first-child {
  width: 80px;
  max-width: 80px;
  min-width: 80px;
  text-align: center;
  font-weight: 600;
  background: var(--light-gray);
}

/* Spacing Utilities */
.mb-small { margin-bottom: 0.5rem; }
.mb-medium { margin-bottom: 1rem; }
.mb-large { margin-bottom: 1.5rem; }

.mt-small { margin-top: 0.5rem; }
.mt-medium { margin-top: 1rem; }
.mt-large { margin-top: 1.5rem; }

/* Responsive */
@media (max-width: 768px) {
  .js-sticky-sidebar {
    position: static !important;
    align-self: auto !important;
    max-height: none !important;
    margin-bottom: 2rem !important;
  }
  
  .sidebar-mobile {
    margin-bottom: 1rem;
  }
  
  .row {
    display: block !important;
  }
  
  .row > [class*="col-"] {
    display: block !important;
    flex-direction: row;
  }
}

/* Smooth transitions for the sticky sidebar */
.js-sticky-sidebar {
  background: #f8f9fa;
  border: 1px solid #dee2e6;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  z-index: 1000;
  max-height: calc(100vh - 40px);
  overflow-y: auto;
  
  /* Smooth transition when switching between fixed and static */
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Enhanced styling when sidebar is fixed */
.js-sticky-sidebar.is-fixed {
  position: fixed !important;
  top: 20px !important;
  box-shadow: 0 8px 25px rgba(0,0,0,0.15);
  border-color: #3498DB;
}

/* Add subtle animation on content cards to make scrolling feel smoother */
.content-card {
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  margin-bottom: 1.5rem;
  min-height: 500px;
  padding: 20px;
  background: white;
  transition: transform 0.2s ease;
}

.content-card:hover {
  transform: translateY(-1px);
}

/* Smooth scrollbar styling for the sticky sidebar */
.js-sticky-sidebar::-webkit-scrollbar {
  width: 6px;
}

.js-sticky-sidebar::-webkit-scrollbar-track {
  background: rgba(0,0,0,0.05);
  border-radius: 3px;
}

.js-sticky-sidebar::-webkit-scrollbar-thumb {
  background: rgba(0,0,0,0.2);
  border-radius: 3px;
  transition: background 0.2s ease;
}

.js-sticky-sidebar::-webkit-scrollbar-thumb:hover {
  background: rgba(0,0,0,0.4);
}

/* Compact table styling for improvement and strength areas */
#improvement_areas,
#strength_areas {
  font-size: 0.9rem;
}

#improvement_areas table,
#strength_areas table {
  margin-bottom: 0 !important;
  width: 100% !important;
}

/* Reduce cell padding for more compact appearance */
#improvement_areas td,
#improvement_areas th,
#strength_areas td,
#strength_areas th {
  padding: 8px 12px !important;
  vertical-align: middle !important;
}

/* Make the first column (milestone description) take up more space */
#improvement_areas td:first-child,
#improvement_areas th:first-child,
#strength_areas td:first-child,
#strength_areas th:first-child {
  width: 50% !important;
  max-width: 300px !important;
}

/* Center align numeric columns */
#improvement_areas td:nth-child(2),
#improvement_areas td:nth-child(3),
#improvement_areas td:nth-child(5),
#strength_areas td:nth-child(2),
#strength_areas td:nth-child(3),
#strength_areas td:nth-child(5) {
  text-align: center !important;
  width: 12% !important;
}

/* Performance context column */
#improvement_areas td:nth-child(4),
#strength_areas td:nth-child(4) {
  width: 20% !important;
  text-align: center !important;
}

/* Remove extra spacing from DataTables wrapper */
#improvement_areas_wrapper,
#strength_areas_wrapper {
  margin-top: 0 !important;
}

#improvement_areas_wrapper .dataTables_info,
#improvement_areas_wrapper .dataTables_paginate,
#strength_areas_wrapper .dataTables_info,
#strength_areas_wrapper .dataTables_paginate {
  margin-top: 5px !important;
  font-size: 0.85rem !important;
}

/* Adjust card body padding for tables */
.content-card .card-body {
  padding: 15px !important;
}

/* Add some visual separation between the stacked tables */
.content-card + .content-card {
  margin-top: 20px;
}